
<!DOCTYPE html>


<html lang="en" data-content_root="../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Relating the Depth and Parent Vectors &#8212; Doing Things in Dyalog APL</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/sphinx-book-theme.css?v=a3416100" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css?v=be8a1c11" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-design.min.css?v=87e54e7c" />
    <link rel="stylesheet" type="text/css" href="../_static/custom.css?v=bfa96906" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="../_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script src="../_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="../_static/doctools.js?v=9a2dae69"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../_static/copybutton.js?v=f281be69"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../_static/design-tabs.js?v=f930bc37"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="../_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'trees/relating-depth-and-parent-vectors';</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Forests" href="forests.html" />
    <link rel="prev" title="Parent Vectors" href="parent-vectors.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="../intro.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../_static/logo.png" class="logo__image only-light" alt="Doing Things in Dyalog APL - Home"/>
    <script>document.write(`<img src="../_static/logo.png" class="logo__image only-dark" alt="Doing Things in Dyalog APL - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../intro.html">
                    Exploring Things with Dyalog APL
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Trees</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="intro.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="representing-trees.html">Representing Trees</a></li>
<li class="toctree-l1"><a class="reference internal" href="parent-vectors.html">Parent Vectors</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Relating the Depth and Parent Vectors</a></li>
<li class="toctree-l1"><a class="reference internal" href="forests.html">Forests</a></li>
<li class="toctree-l1"><a class="reference internal" href="deleting-nodes.html">Deleting Nodes</a></li>
<li class="toctree-l1"><a class="reference internal" href="bottom-up-aggregation.html">Bottom-Up Accumulation</a></li>
<li class="toctree-l1"><a class="reference internal" href="working-with-json.html">Working with <code class="docutils literal notranslate"><span class="pre">⎕JSON</span></code></a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Combinatorics</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../combinatorics/enumerative.html">Enumerative Combinatorics</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../combinatorics/combinations-and-bijective-proofs.html">Combinations and Bijective Proofs</a></li>
<li class="toctree-l2"><a class="reference internal" href="../combinatorics/counting-functions.html">Counting Functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../combinatorics/inclusion-exclusion.html">Inclusion-Exclusion and Counting Partitions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../combinatorics/stars-bars.html">Stars and Bars</a></li>
<li class="toctree-l2"><a class="reference internal" href="../combinatorics/integer-partitions.html">Integer Partitions</a></li>
</ul>
</details></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/executablebooks/jupyter-book" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/executablebooks/jupyter-book/issues/new?title=Issue%20on%20page%20%2Ftrees/relating-depth-and-parent-vectors.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../_sources/trees/relating-depth-and-parent-vectors.md" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.md</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm pst-navbar-icon search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Relating the Depth and Parent Vectors</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#constructing-the-parent-vector">Constructing the Parent Vector</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#recovering-depths">Recovering Depths</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#depth-vector-ordering">Depth Vector Ordering</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="relating-the-depth-and-parent-vectors">
<h1>Relating the Depth and Parent Vectors<a class="headerlink" href="#relating-the-depth-and-parent-vectors" title="Link to this heading">#</a></h1>
<p>While we are focusing on the parent vector representation, the depth vector is still very useful, and in many applications we will begin with a depth vector and later construct a parent vector. This page covers constructing a parent vector from a depth vector, finding the depths of nodes in a parent vector, and ordering a parent vector in the same way as the corresponding depth vector.</p>
<section id="constructing-the-parent-vector">
<h2>Constructing the Parent Vector<a class="headerlink" href="#constructing-the-parent-vector" title="Link to this heading">#</a></h2>
<p>The first thing we’ll look at is constructing a parent vector, given a depth vector. In the page on <a class="reference internal" href="working-with-json.html"><span class="std std-doc">working with <code class="docutils literal notranslate"><span class="pre">⎕JSON</span></code></span></a>, we will begin with a depth vector, and construct a parent vector in order to do more complicated operations. So it’s important for us to be able to make this conversion.</p>
<p>Let’s look at the same tree we worked with in the page on <a class="reference internal" href="representing-trees.html"><span class="std std-doc">representing trees</span></a>.</p>
<figure class="align-default" id="id1">
<img alt="A simple tree with nodes labelled in DFPT order." src="../_images/IntroTreeDFPT_ManimCE_v0.18.1.png" />
<figcaption>
<p><span class="caption-number">Fig. 16 </span><span class="caption-text">Our simple tree.</span><a class="headerlink" href="#id1" title="Link to this image">#</a></p>
</figcaption>
</figure>
<p>The depth vector for this tree is:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">d</span><span class="kd">←</span><span class="m">0</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="m">3</span><span class="w"> </span><span class="m">3</span><span class="w"> </span><span class="m">3</span><span class="w"> </span><span class="m">1</span>
</pre></div>
</div>
</div>
</div>
<p>For each node <code class="docutils literal notranslate"><span class="pre">i</span></code> in this tree, we want to find the index <code class="docutils literal notranslate"><span class="pre">j</span></code> of the node which is the parent of <code class="docutils literal notranslate"><span class="pre">i</span></code>. Recall that the nodes in any sub-tree are necessarily adjacent in the depth vector. Also notice that the root of a sub-tree appears immediately before all of its descendants.</p>
<figure class="align-default" id="id2">
<img alt="An animation of the tree with depth labels flattening into the depth vector. A sub-tree is highlighted." src="../_images/IntroTreeFlatten_ManimCE_v0.18.1.gif" />
<figcaption>
<p><span class="caption-number">Fig. 17 </span><span class="caption-text">The location of a sub-tree in the depth vector.</span><a class="headerlink" href="#id2" title="Link to this image">#</a></p>
</figcaption>
</figure>
<p>Finally, if <code class="docutils literal notranslate"><span class="pre">j</span></code> is the parent of <code class="docutils literal notranslate"><span class="pre">i</span></code>, we know that <code class="docutils literal notranslate"><span class="pre">j</span></code> must have a depth one less than the depth of <code class="docutils literal notranslate"><span class="pre">i</span></code>, i.e. <code class="docutils literal notranslate"><span class="pre">d[j]=d[i]-1</span></code>. All of this information together leads to a neat method for constructing a parent vector from a depth vector.</p>
<p>Firstly, we want to group the nodes in the depth vector by their given depth. <code class="docutils literal notranslate"><span class="pre">⌸</span></code> (Key) is the perfect primitive for this:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="o">⊂</span><span class="na">⍤</span><span class="o">⊢</span><span class="na">⌸</span><span class="nv">d</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><pre class="language-APL">┌─┬─────┬─────┬─────┐
│0│1 4 9│2 3 5│6 7 8│
└─┴─────┴─────┴─────┘
</pre></div></div>
</div>
<p>Here, we have grouped the nodes in the tree by their depth. <code class="docutils literal notranslate"><span class="pre">⌸</span></code> orders the groups it creates by the order the values appear in its right argument. The ordering of the depth vector ensures that this is exactly the all of the possible depths of the tree in ascending order. So, at index <span class="math notranslate nohighlight">\(0\)</span> we have all nodes with a depth of <span class="math notranslate nohighlight">\(0\)</span> (in our case just the single root), at index <span class="math notranslate nohighlight">\(1\)</span> we have all those with a depth of <span class="math notranslate nohighlight">\(1\)</span>, and so on.</p>
<p>Any non-root node <code class="docutils literal notranslate"><span class="pre">i</span></code> will appear after its parent <code class="docutils literal notranslate"><span class="pre">j</span></code> in the depth vector, and before the next node at the same depth as its parent. It is not possible for there to be another node with the same depth as <code class="docutils literal notranslate"><span class="pre">j</span></code> which appears between <code class="docutils literal notranslate"><span class="pre">i</span></code> and <code class="docutils literal notranslate"><span class="pre">j</span></code>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>   no 1s here
      ┌┴┐
d: 0 1 2 2 1 2 3 3 3 1
     ↑   ↑
     j   i
</pre></div>
</div>
<p>Look again at our nodes grouped by their depth:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="o">⊂</span><span class="na">⍤</span><span class="o">⊢</span><span class="na">⌸</span><span class="nv">d</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><pre class="language-APL">┌─┬─────┬─────┬─────┐
│0│1 4 9│2 3 5│6 7 8│
└─┴─────┴─────┴─────┘
</pre></div></div>
</div>
<p>Since the parent of <code class="docutils literal notranslate"><span class="pre">i</span></code> has depth one less than <code class="docutils literal notranslate"><span class="pre">i</span></code>, it must appear in the group immediately preceding the group that contains <code class="docutils literal notranslate"><span class="pre">i</span></code>. Within that group, the parent of <code class="docutils literal notranslate"><span class="pre">i</span></code> must be the leftmost node (i.e. node with the largest index) that is not later than (has a greater index than) <code class="docutils literal notranslate"><span class="pre">i</span></code>. In this sense, the groups define intervals of the indexes of the depth vector, splitting it up into sub-trees. We can use this to find the parent of each node using <code class="docutils literal notranslate"><span class="pre">⍸</span></code> (Interval Index).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">i</span><span class="kd">←</span><span class="m">3</span><span class="w">               </span><span class="c1">⍝ let&#39;s find the parent of node 3</span>
<span class="m">1</span><span class="w"> </span><span class="m">4</span><span class="w"> </span><span class="m">9</span><span class="o">⍸</span><span class="nv">i</span><span class="w">           </span><span class="c1">⍝ where in the group is the parent of node 3</span>
<span class="m">1</span><span class="w"> </span><span class="m">4</span><span class="w"> </span><span class="m">9</span><span class="sr">[</span><span class="m">1</span><span class="w"> </span><span class="m">4</span><span class="w"> </span><span class="m">9</span><span class="o">⍸</span><span class="nv">i</span><span class="sr">]</span><span class="w">    </span><span class="c1">⍝ which node is the parent of node 3</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><pre class="language-APL">0
</pre></div><div class="output text_html"><pre class="language-APL">1
</pre></div></div>
</div>
<p>Of course, this works for finding the parents of the whole group of nodes at a certain depth.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">i</span><span class="kd">←</span><span class="m">2</span><span class="w"> </span><span class="m">3</span><span class="w"> </span><span class="m">5</span><span class="w">           </span><span class="c1">⍝ all nodes at depth 2</span>
<span class="m">1</span><span class="w"> </span><span class="m">4</span><span class="w"> </span><span class="m">9</span><span class="o">⍸</span><span class="nv">i</span>
<span class="m">1</span><span class="w"> </span><span class="m">4</span><span class="w"> </span><span class="m">9</span><span class="sr">[</span><span class="m">1</span><span class="w"> </span><span class="m">4</span><span class="w"> </span><span class="m">9</span><span class="o">⍸</span><span class="nv">i</span><span class="sr">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><pre class="language-APL">0 0 1
</pre></div><div class="output text_html"><pre class="language-APL">1 1 4
</pre></div></div>
</div>
<p>We can use this trick to finally construct the parent vector corresponding to the tree. First we initialise the parent vector so that all nodes are roots. We will update all non-roots with their parents.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="o">⊢</span><span class="nv">p</span><span class="kd">←</span><span class="o">⍳≢</span><span class="nv">d</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><pre class="language-APL">0 1 2 3 4 5 6 7 8 9
</pre></div></div>
</div>
<p>We then want to look at each adjacent pair of groups and update <code class="docutils literal notranslate"><span class="pre">p</span></code> accordingly, which we can do with a windowed reduction:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="c1">⍝  ┌──┬─ {⍺⍵} is executed with ⍺ as the left group and ⍵ as the right group</span>
<span class="w">  </span><span class="m">2</span><span class="kt">{</span><span class="bp">⍺⍵</span><span class="kt">}</span><span class="na">/</span><span class="o">⊂</span><span class="na">⍤</span><span class="o">⊢</span><span class="na">⌸</span><span class="nv">d</span>
<span class="w">  </span><span class="m">2</span><span class="kt">{</span><span class="nv">p</span><span class="sr">[</span><span class="bp">⍵</span><span class="sr">]</span><span class="kd">←</span><span class="bp">⍺</span><span class="sr">[</span><span class="bp">⍺</span><span class="o">⍸</span><span class="bp">⍵</span><span class="sr">]</span><span class="kt">}</span><span class="na">/</span><span class="o">⊂</span><span class="na">⍤</span><span class="o">⊢</span><span class="na">⌸</span><span class="nv">d</span>
<span class="c1">⍝  └───────────┴─ instead, we can use our method to update p</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><pre class="language-APL">┌─────────┬─────────────┬─────────────┐
│┌─┬─────┐│┌─────┬─────┐│┌─────┬─────┐│
││0│1 4 9│││1 4 9│2 3 5│││2 3 5│6 7 8││
│└─┴─────┘│└─────┴─────┘│└─────┴─────┘│
└─────────┴─────────────┴─────────────┘
</pre></div></div>
</div>
<p>After this operation, we have successfully created the parent vector corresponding to <code class="docutils literal notranslate"><span class="pre">d</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">p</span>
<span class="nv">d</span><span class="w"> </span><span class="nv">PPV</span><span class="w"> </span><span class="nv">p</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><pre class="language-APL">0 0 1 1 0 4 5 5 5 0
</pre></div><div class="output text_html"><pre class="language-APL">┌───────────┐
│     0     │
│ ┌───┴┬───┐│
│ 1    1   1│
│┌┴┐   │    │
│2 2   2    │
│    ┌─┼─┐  │
│    3 3 3  │
└───────────┘
</pre></div></div>
</div>
<p>Putting it all together:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">DepthToParent</span><span class="kd">←</span><span class="kt">{</span><span class="w"> </span><span class="c1">⍝ return the parent vector representation of a tree from a depth vector</span>
<span class="w">    </span><span class="c1">⍝ ←: the parent vector corresponding to the depth vector input</span>
<span class="w">    </span><span class="nv">d</span><span class="kd">←</span><span class="bp">⍵</span><span class="w">                       </span><span class="c1">⍝ depth vector to be parentified</span>
<span class="w">    </span><span class="nv">p</span><span class="kd">←</span><span class="o">⍳≢</span><span class="nv">d</span><span class="w">                     </span><span class="c1">⍝ begin by setting all nodes as roots</span>
<span class="w">    </span><span class="nv">_</span><span class="kd">←</span><span class="m">2</span><span class="kt">{</span><span class="nv">p</span><span class="sr">[</span><span class="bp">⍵</span><span class="sr">]</span><span class="kd">←</span><span class="bp">⍺</span><span class="sr">[</span><span class="bp">⍺</span><span class="o">⍸</span><span class="bp">⍵</span><span class="sr">]</span><span class="kt">}</span><span class="na">/</span><span class="o">⊂</span><span class="na">⍤</span><span class="o">⊢</span><span class="na">⌸</span><span class="nv">d</span><span class="w">    </span><span class="c1">⍝ find the parents of each non-root</span>
<span class="w">    </span><span class="c1">⍝ │ │   ││    │ │└───┴─ indices of each level</span>
<span class="w">    </span><span class="c1">⍝ └─│───││────│─┴─ pairwise between levels</span>
<span class="w">    </span><span class="c1">⍝   │   │└────┴─ leftmost node at previous level - the parent</span>
<span class="w">    </span><span class="c1">⍝   └───┴─ make this the parent</span>
<span class="w">    </span><span class="nv">p</span>
<span class="kt">}</span>
</pre></div>
</div>
</div>
</div>
<p>Now that we can convert depth vectors to parent vectors, a natural next question is converting parent vectors back into depth vectors. There are two stages to this: firstly finding the depths of each node, and secondly imposing the DFPT ordering on the nodes.</p>
</section>
<section id="recovering-depths">
<h2>Recovering Depths<a class="headerlink" href="#recovering-depths" title="Link to this heading">#</a></h2>
<p>We will look at finding the depths of each node in a parent vector first. Our method will be roughly to see how many jumps to parents it takes to reach a root.</p>
<p>Take our current tree:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="o">⍳≢</span><span class="nv">p</span><span class="p">)</span><span class="w"> </span><span class="nv">PPV</span><span class="w"> </span><span class="nv">p</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><pre class="language-APL">┌───────────┐
│     0     │
│ ┌───┴┬───┐│
│ 1    4   9│
│┌┴┐   │    │
│2 3   5    │
│    ┌─┼─┐  │
│    6 7 8  │
└───────────┘
</pre></div></div>
</div>
<p>Since we constructed this parent vector from a depth vector, it is already in DFPT order. To emphasise that the parent vector need not be in this order (and to give us something to do when we get the order back), we’re going to shuffle it.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">perm</span><span class="kd">←</span><span class="m">3</span><span class="w"> </span><span class="m">5</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">7</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">6</span><span class="w"> </span><span class="m">8</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="m">4</span><span class="w"> </span><span class="m">9</span><span class="w">    </span><span class="c1">⍝ an arbitrary(-ish) permutation of the nodes</span>
<span class="o">⊢</span><span class="nv">p</span><span class="kd">←</span><span class="nv">perm</span><span class="o">⍳</span><span class="nv">p</span><span class="sr">[</span><span class="nv">perm</span><span class="sr">]</span>
<span class="p">(</span><span class="o">⍳≢</span><span class="nv">p</span><span class="p">)</span><span class="w"> </span><span class="nv">PPV</span><span class="w"> </span><span class="nv">p</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><pre class="language-APL">2 8 4 1 4 1 1 2 4 4
</pre></div><div class="output text_html"><pre class="language-APL">┌───────────┐
│     4     │
│ ┌───┴┬───┐│
│ 2    8   9│
│┌┴┐   │    │
│0 7   1    │
│    ┌─┼─┐  │
│    3 5 6  │
└───────────┘
</pre></div></div>
</div>
<p>Note that the particular shuffle we’ve chosen here preserves the order of siblings in the tree. If your use of trees depends on sibling order, you’ll want to make sure that any time your tree is re-ordered, the order of siblings is preserved.</p>
<p>To find the depth of each of these nodes, we will repeatedly follow parent pointers until we reach a root. Once we do reach a root, the number of jumps it took to get there will be the depth of the node.</p>
<p>Let’s use node <span class="math notranslate nohighlight">\(1\)</span> as an example. This node has depth <span class="math notranslate nohighlight">\(2\)</span>, which we can be sure of as two parental jumps reaches a root.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">p</span><span class="sr">[</span><span class="m">1</span><span class="sr">]</span><span class="w">          </span><span class="c1">⍝ depth ≥ 1 since 1 is not a root</span>
<span class="nv">p</span><span class="sr">[</span><span class="nv">p</span><span class="sr">[</span><span class="m">1</span><span class="sr">]]</span><span class="w">       </span><span class="c1">⍝ depth ≥ 2 since p[1] is not a root</span>
<span class="nv">p</span><span class="sr">[</span><span class="nv">p</span><span class="sr">[</span><span class="nv">p</span><span class="sr">[</span><span class="m">1</span><span class="sr">]]]</span><span class="w">    </span><span class="c1">⍝ depth = 2 since p[p[1]] is a root</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><pre class="language-APL">8
</pre></div><div class="output text_html"><pre class="language-APL">4
</pre></div><div class="output text_html"><pre class="language-APL">4
</pre></div></div>
</div>
<p>Since we’re traversing the tree until the parent does not change, we can automate this repetition with <code class="docutils literal notranslate"><span class="pre">⍣≡</span></code> to find the depth of any particular node.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">depth</span><span class="kd">←</span><span class="m">0</span><span class="w">           </span><span class="c1">⍝ seed value</span>
<span class="nv">StepUp</span><span class="kd">←</span><span class="kt">{</span>
<span class="w">    </span><span class="nv">q</span><span class="kd">←</span><span class="nv">p</span><span class="sr">[</span><span class="bp">⍵</span><span class="sr">]</span><span class="w">        </span><span class="c1">⍝ parent of current node</span>
<span class="w">    </span><span class="nv">depth</span><span class="o">+</span><span class="kd">←</span><span class="bp">⍵</span><span class="o">≠</span><span class="nv">q</span><span class="w">    </span><span class="c1">⍝ increment depth if not a root</span>
<span class="w">    </span><span class="nv">q</span>
<span class="kt">}</span>
<span class="nv">_</span><span class="kd">←</span><span class="nv">StepUp</span><span class="na">⍣</span><span class="o">≡</span><span class="m">1</span>
<span class="nv">depth</span><span class="w">             </span><span class="c1">⍝ node 1 has depth 2</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><pre class="language-APL">2
</pre></div></div>
</div>
<p>This method can be easily extended to find the depths of all nodes at once.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">depths</span><span class="kd">←</span><span class="p">(</span><span class="o">≢</span><span class="nv">p</span><span class="p">)</span><span class="o">⍴</span><span class="m">0</span><span class="w">      </span><span class="c1">⍝ seed for all nodes</span>
<span class="nv">StepUp</span><span class="kd">←</span><span class="kt">{</span>
<span class="w">    </span><span class="nv">q</span><span class="kd">←</span><span class="nv">p</span><span class="sr">[</span><span class="bp">⍵</span><span class="sr">]</span>
<span class="w">    </span><span class="nv">depths</span><span class="o">+</span><span class="kd">←</span><span class="bp">⍵</span><span class="o">≠</span><span class="nv">q</span><span class="w">    </span><span class="c1">⍝ increment for each path which has not hit a root</span>
<span class="w">    </span><span class="nv">q</span>
<span class="kt">}</span>
<span class="nv">_</span><span class="kd">←</span><span class="nv">StepUp</span><span class="na">⍣</span><span class="o">≡⍳≢</span><span class="nv">p</span><span class="w">      </span><span class="c1">⍝ all nodes this time</span>
<span class="nv">depths</span>
<span class="nv">depths</span><span class="w"> </span><span class="nv">PPV</span><span class="w"> </span><span class="nv">p</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><pre class="language-APL">2 2 1 3 0 3 3 2 1 1
</pre></div><div class="output text_html"><pre class="language-APL">┌───────────┐
│     0     │
│ ┌───┴┬───┐│
│ 1    1   1│
│┌┴┐   │    │
│2 2   2    │
│    ┌─┼─┐  │
│    3 3 3  │
└───────────┘
</pre></div></div>
</div>
<p>Wrapping it all up in a dfn:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">Depths</span><span class="kd">←</span><span class="kt">{</span><span class="w"> </span><span class="c1">⍝ find the depths of each node in a parent vector</span>
<span class="w">    </span><span class="c1">⍝ ←: a vector of the depths of each node in the input</span>
<span class="w">    </span><span class="nv">p</span><span class="kd">←</span><span class="bp">⍵</span><span class="w">    </span><span class="c1">⍝ input parent vector</span>
<span class="w">    </span><span class="nv">depths</span><span class="kd">←</span><span class="p">(</span><span class="o">≢</span><span class="nv">p</span><span class="p">)</span><span class="o">⍴</span><span class="m">0</span>
<span class="w">    </span><span class="nv">StepUp</span><span class="kd">←</span><span class="kt">{</span><span class="w"> </span><span class="c1">⍝ step up the tree and increment depths</span>
<span class="w">        </span><span class="nv">q</span><span class="kd">←</span><span class="nv">p</span><span class="sr">[</span><span class="bp">⍵</span><span class="sr">]</span>
<span class="w">        </span><span class="nv">depths</span><span class="o">+</span><span class="kd">←</span><span class="bp">⍵</span><span class="o">≠</span><span class="nv">q</span>
<span class="w">        </span><span class="nv">q</span>
<span class="w">    </span><span class="kt">}</span>
<span class="w">    </span><span class="nv">_</span><span class="kd">←</span><span class="nv">StepUp</span><span class="na">⍣</span><span class="o">≡⍳≢</span><span class="nv">p</span>
<span class="w">    </span><span class="nv">depths</span>
<span class="kt">}</span>
<span class="p">(</span><span class="nv">Depths</span><span class="w"> </span><span class="nv">p</span><span class="p">)</span><span class="w"> </span><span class="nv">PPV</span><span class="w"> </span><span class="nv">p</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><pre class="language-APL">┌───────────┐
│     0     │
│ ┌───┴┬───┐│
│ 1    1   1│
│┌┴┐   │    │
│2 2   2    │
│    ┌─┼─┐  │
│    3 3 3  │
└───────────┘
</pre></div></div>
</div>
<p>Remember: <code class="docutils literal notranslate"><span class="pre">depths</span></code> is not in DFPT order! Our next task will be to put it back in that order to fully recover the depth vector.</p>
<p><strong>Challenge:</strong> Can you change the initial conditions of our method so that we can skip the first iteration?</p>
<p><strong>Solution:</strong></p>
<div class="cell tag_hide-cell docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell content</span>
<span class="expanded">Hide code cell content</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">Depths</span><span class="kd">←</span><span class="kt">{</span><span class="w"> </span><span class="c1">⍝ find the depths of each node in a parent vector</span>
<span class="w">    </span><span class="nv">p</span><span class="kd">←</span><span class="bp">⍵</span>
<span class="w">    </span><span class="nv">depths</span><span class="kd">←</span><span class="nv">p</span><span class="o">≠⍳≢</span><span class="nv">p</span><span class="w">    </span><span class="c1">⍝ skip the first iteration by incrementing non-roots up-front</span>
<span class="w">    </span><span class="nv">StepUp</span><span class="kd">←</span><span class="kt">{</span>
<span class="w">        </span><span class="nv">q</span><span class="kd">←</span><span class="nv">p</span><span class="sr">[</span><span class="bp">⍵</span><span class="sr">]</span>
<span class="w">        </span><span class="nv">depths</span><span class="o">+</span><span class="kd">←</span><span class="bp">⍵</span><span class="o">≠</span><span class="nv">q</span>
<span class="w">        </span><span class="nv">q</span>
<span class="w">    </span><span class="kt">}</span>
<span class="w">    </span><span class="nv">_</span><span class="kd">←</span><span class="nv">StepUp</span><span class="na">⍣</span><span class="o">≡</span><span class="nv">p</span><span class="w">     </span><span class="c1">⍝ we can now skip straight to p</span>
<span class="w">    </span><span class="nv">depths</span>
<span class="kt">}</span>
<span class="p">(</span><span class="nv">Depths</span><span class="w"> </span><span class="nv">p</span><span class="p">)</span><span class="w"> </span><span class="nv">PPV</span><span class="w"> </span><span class="nv">p</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><pre class="language-APL">┌───────────┐
│     0     │
│ ┌───┴┬───┐│
│ 1    1   1│
│┌┴┐   │    │
│2 2   2    │
│    ┌─┼─┐  │
│    3 3 3  │
└───────────┘
</pre></div></div>
</details>
</div>
</section>
<section id="depth-vector-ordering">
<h2>Depth Vector Ordering<a class="headerlink" href="#depth-vector-ordering" title="Link to this heading">#</a></h2>
<p>Having recovered the depths of each node, the next step fully reconstructing the depth vector for a tree is imposing the DFPT ordering. To do this, we’re going to augment our method for find depths to build up a kind of path matrix for the tree as we go. We can then use the paths to find the DFPT ordering.</p>
<p>To begin with, let’s initialise an empty matrix.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">paths</span><span class="kd">←</span><span class="p">(</span><span class="o">≢</span><span class="nv">p</span><span class="p">)</span><span class="m">0</span><span class="o">⍴</span><span class="no">⍬</span>
</pre></div>
</div>
</div>
</div>
<p>Now, as we traverse the tree to find depths, we can also record the ancestors found at each iteration into <code class="docutils literal notranslate"><span class="pre">paths</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">depths</span><span class="kd">←</span><span class="p">(</span><span class="o">≢</span><span class="nv">p</span><span class="p">)</span><span class="o">⍴</span><span class="m">0</span>
<span class="nv">StepUp</span><span class="kd">←</span><span class="kt">{</span>
<span class="w">    </span><span class="nv">paths</span><span class="o">,</span><span class="kd">←</span><span class="bp">⍵</span><span class="w">       </span><span class="c1">⍝ record the nodes found at this iteration</span>
<span class="w">    </span><span class="nv">q</span><span class="kd">←</span><span class="nv">p</span><span class="sr">[</span><span class="bp">⍵</span><span class="sr">]</span>
<span class="w">    </span><span class="nv">depths</span><span class="o">+</span><span class="kd">←</span><span class="bp">⍵</span><span class="o">≠</span><span class="nv">q</span>
<span class="w">    </span><span class="nv">q</span>
<span class="kt">}</span>
<span class="nv">_</span><span class="kd">←</span><span class="nv">StepUp</span><span class="na">⍣</span><span class="o">≡⍳≢</span><span class="nv">p</span>
</pre></div>
</div>
</div>
</div>
<p>Now, if we look at <code class="docutils literal notranslate"><span class="pre">paths</span></code>, we can see that the first column is all the nodes in the tree, the second column is their parents, and so on.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">paths</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><pre class="language-APL">0 2 4 4
1 8 4 4
2 4 4 4
3 1 8 4
4 4 4 4
5 1 8 4
6 1 8 4
7 2 4 4
8 4 4 4
9 4 4 4
</pre></div></div>
</div>
<p>Each row records a path from node to root, with padding at the end for shallow nodes. We a little effort, we can extract the paths from root to node, without padding.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="o">⍪</span><span class="nv">paths</span><span class="kd">←</span><span class="o">⌽</span><span class="na">¨</span><span class="p">(</span><span class="nv">depths</span><span class="o">+</span><span class="m">1</span><span class="p">)</span><span class="o">⊂</span><span class="na">⍤</span><span class="o">↑</span><span class="na">⍤</span><span class="m">¯1</span><span class="o">⊢</span><span class="nv">paths</span>
<span class="c1">⍝      ││└───────────┴─ there are depths[i]+1 nodes on the path from i to the root</span>
<span class="c1">⍝      └┴────────────── get root → node rather than node → root</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><pre class="language-APL">┌───────┐
│4 2 0  │
├───────┤
│4 8 1  │
├───────┤
│4 2    │
├───────┤
│4 8 1 3│
├───────┤
│4      │
├───────┤
│4 8 1 5│
├───────┤
│4 8 1 6│
├───────┤
│4 2 7  │
├───────┤
│4 8    │
├───────┤
│4 9    │
└───────┘
</pre></div></div>
</div>
<p>If we look again at our tree, and list out the first few paths in the DFPT of it, we notice an interesting pattern.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="o">⍳≢</span><span class="nv">p</span><span class="p">)</span><span class="w"> </span><span class="nv">PPV</span><span class="w"> </span><span class="nv">p</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><pre class="language-APL">┌───────────┐
│     4     │
│ ┌───┴┬───┐│
│ 2    8   9│
│┌┴┐   │    │
│0 7   1    │
│    ┌─┼─┐  │
│    3 5 6  │
└───────────┘
</pre></div></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>4
4 → 2
4 → 2 → 0
4 → 2 → 7
4 → 8
4 → 8 → 1
...
</pre></div>
</div>
<p>In the DFPT, the paths are ordered first by the size of the index in each place (<span class="math notranslate nohighlight">\(0&lt;7\)</span>, <span class="math notranslate nohighlight">\(2&lt;8\)</span>, etc), and then by the length of the whole paths. This is exactly a <a class="reference external" href="https://en.wikipedia.org/wiki/Lexicographic_order">lexicographic ordering</a> of the paths. Fortunately for us, this is also the ordering which <code class="docutils literal notranslate"><span class="pre">⍋</span></code> uses to grade arrays. Therefore, finding the DFPT order of the nodes is as simple as <code class="docutils literal notranslate"><span class="pre">⍋</span></code>ing the paths.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="o">⍪</span><span class="nv">paths</span><span class="sr">[</span><span class="o">⍋</span><span class="nv">paths</span><span class="sr">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><pre class="language-APL">┌───────┐
│4      │
├───────┤
│4 2    │
├───────┤
│4 2 0  │
├───────┤
│4 2 7  │
├───────┤
│4 8    │
├───────┤
│4 8 1  │
├───────┤
│4 8 1 3│
├───────┤
│4 8 1 5│
├───────┤
│4 8 1 6│
├───────┤
│4 9    │
└───────┘
</pre></div></div>
</div>
<p>Using this order to rearrange the depths of the nodes gives us exactly the depth vector for our tree.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">depths</span><span class="sr">[</span><span class="o">⍋</span><span class="nv">paths</span><span class="sr">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><pre class="language-APL">0 1 2 2 1 2 3 3 3 1
</pre></div></div>
</div>
<p>Huzzah! This is the depth vector we started with at the top of the page.</p>
<p>As we’ll see <a class="reference internal" href="working-with-json.html"><span class="std std-doc">later</span></a>, we often have other vectors of data associated with our trees. When we find the depth vector of a tree, we will also want to re-order this extra data so that it still lines up. Therefore, when we wrap this method up in a dfn, we will have it return the depths and the ordering separately, allowing the caller to use the ordering to shuffle any extra data they like.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">ParentToDepth</span><span class="kd">←</span><span class="kt">{</span><span class="w"> </span><span class="c1">⍝ recover the depths and DFPT ordering of a parent vector</span>
<span class="w">    </span><span class="c1">⍝ ←: a two element vector consisting of (1) the depths of each node and (2) the permutation vector for DFPT order</span>
<span class="w">    </span><span class="nv">p</span><span class="kd">←</span><span class="bp">⍵</span><span class="w">    </span><span class="c1">⍝ input parent vector</span>
<span class="w">    </span><span class="nv">paths</span><span class="kd">←</span><span class="p">(</span><span class="o">≢</span><span class="nv">p</span><span class="p">)</span><span class="m">0</span><span class="o">⍴</span><span class="no">⍬</span>
<span class="w">    </span><span class="nv">depths</span><span class="kd">←</span><span class="p">(</span><span class="o">≢</span><span class="nv">p</span><span class="p">)</span><span class="o">⍴</span><span class="m">0</span>
<span class="w">    </span><span class="nv">StepUp</span><span class="kd">←</span><span class="kt">{</span>
<span class="w">        </span><span class="nv">paths</span><span class="o">,</span><span class="kd">←</span><span class="bp">⍵</span>
<span class="w">        </span><span class="nv">q</span><span class="kd">←</span><span class="nv">p</span><span class="sr">[</span><span class="bp">⍵</span><span class="sr">]</span>
<span class="w">        </span><span class="nv">depths</span><span class="o">+</span><span class="kd">←</span><span class="bp">⍵</span><span class="o">≠</span><span class="nv">q</span>
<span class="w">        </span><span class="nv">q</span>
<span class="w">    </span><span class="kt">}</span>
<span class="w">    </span><span class="nv">_</span><span class="kd">←</span><span class="nv">StepUp</span><span class="na">⍣</span><span class="o">≡⍳≢</span><span class="nv">p</span>
<span class="w">    </span><span class="nv">order</span><span class="kd">←</span><span class="o">⍋⌽</span><span class="na">¨</span><span class="p">(</span><span class="nv">depths</span><span class="o">+</span><span class="m">1</span><span class="p">)</span><span class="o">⊂</span><span class="na">⍤</span><span class="o">↑</span><span class="na">⍤</span><span class="m">¯1</span><span class="o">⊢</span><span class="nv">paths</span>
<span class="w">    </span><span class="nv">depths</span><span class="w"> </span><span class="nv">order</span>
<span class="kt">}</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "dyalog_apl"
        },
        kernelOptions: {
            name: "dyalog_apl",
            path: "./trees"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'dyalog_apl'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="parent-vectors.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Parent Vectors</p>
      </div>
    </a>
    <a class="right-next"
       href="forests.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Forests</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#constructing-the-parent-vector">Constructing the Parent Vector</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#recovering-depths">Recovering Depths</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#depth-vector-ordering">Depth Vector Ordering</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Asher Harvey-Smith
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2023.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>